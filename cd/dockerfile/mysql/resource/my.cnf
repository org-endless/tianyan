[client]
default-character-set = utf8mb4  # 设置客户端默认字符集为 utf8mb4

[mysqld]
# 基础设置
user = mysql  # 设置 MySQL 运行的用户
port = 13000  # 设置 MySQL 监听端口为 13000
bind-address = 0.0.0.0  # 允许远程连接
datadir = /var/lib/mysql  # 数据存储目录
socket = /var/lib/mysql/mysql.sock  # socket 文件位置
pid-file = /var/lib/mysql/mysql.pid  # 进程 ID 文件路径

# 连接管理（高并发优化）
max_connections = 1000  # 最大连接数（根据需求调整）
table_open_cache = 8000  # 打开表缓存，提高表访问性能
open_files_limit = 17010  # 打开表缓存，提高表访问性能
table_definition_cache = 4400  # 提高表结构缓存，防止频繁解析
wait_timeout = 28800  # 连接超时时间（8小时）
interactive_timeout = 28800  # 交互式连接超时

# InnoDB 存储引擎优化（提高数据库吞吐）
innodb_buffer_pool_size = 8G  # 缓冲池大小，占 50-70% 总内存
innodb_buffer_pool_instances = 4  # 分片，减少锁争用
innodb_flush_log_at_trx_commit = 1  # 事务安全模式
innodb_log_buffer_size = 256M  # 事务日志缓冲
innodb_flush_method = O_DIRECT  # 避免 OS 额外缓存
innodb_io_capacity = 4000  # 适配高 IOPS 设备
innodb_io_capacity_max = 8000  # 最大 IOPS
innodb_thread_concurrency = 100  # 并发线程数，适配高性能服务器
innodb_purge_threads = 4  # 垃圾回收线程数
innodb_adaptive_hash_index = ON  # 开启自适应哈希索引
innodb_read_io_threads = 4  # 读取 IO 线程
innodb_write_io_threads = 4  # 写入 IO 线程
innodb_file_per_table = ON  # 表独立存储，提高表空间管理

# 查询优化（适配大量访问）
tmp_table_size = 256M  # 临时表最大大小
max_heap_table_size = 256M  # 最大内存表大小
join_buffer_size = 8M  # JOIN 缓存
sort_buffer_size = 4M  # 排序缓存
read_buffer_size = 4M  # 顺序读取缓存
read_rnd_buffer_size = 8M  # 随机读取缓存
bulk_insert_buffer_size = 128M  # 批量插入缓冲
max_prepared_stmt_count = 100000  # 防止 SQL 预编译语句达到上限

# 连接池（应用层高并发）
performance_schema = ON  # 开启性能模式
thread_cache_size = 18  # 线程缓存，加速连接重用
thread_handling = one-thread-per-connection  # 线程池模式，提高吞吐

# 日志与监控
slow_query_log = ON  # 开启慢查询日志
slow_query_log_file = /var/log/mysql/slow.log  # 慢查询日志文件路径
long_query_time = 2  # 超过 2 秒的 SQL 视为慢查询
log_error = /var/log/mysql/error.log  # 错误日志文件路径
log_bin = /var/log/mysql/mysql-bin.log  # 二进制日志文件路径
binlog_expire_logs_seconds = 604800  # 二进制日志保存 7 天
log_output = FILE  # 确保日志输出为文件
log_timestamps = SYSTEM  # 设置日志时间为系统时间
# 安全性
secure_file_priv = NULL  # 限制导入/导出路径
skip_show_database = OFF  # 禁止 `SHOW DATABASES` 防止信息泄露

[mysqldump]
quick  # 启用快速导出模式
max_allowed_packet = 128M  # 设置最大允许的数据包大小

[mysql]
no-auto-rehash  # 禁用自动重新哈希（提升性能）
default-character-set = utf8mb4  # 设置默认字符集为 utf8mb4
